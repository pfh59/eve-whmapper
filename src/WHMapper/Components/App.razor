<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Eve WHMapper</title>
    <base href="/" />
    
    <!-- Preconnect to external resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    
    <!-- External fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet" />
    
    <!-- Third-party styles -->
    <link rel="stylesheet" href="bootstrap/bootstrap.min.css" />
    <link rel="stylesheet" href="_content/MudBlazor/MudBlazor.min.css" />
    <link rel="stylesheet" href="_content/Z.Blazor.Diagrams/style.min.css" />
    <link rel="stylesheet" href="_content/Z.Blazor.Diagrams/default.styles.min.css" />
    
    <!-- Application styles -->
    <link rel="stylesheet" href="app.css" />
    <link rel="stylesheet" href="WHMapper.styles.css" />
    
    <HeadOutlet @rendermode="new InteractiveServerRenderMode(prerender: false)" />
</head>

<body>
    <Routes @rendermode="new InteractiveServerRenderMode(prerender: false)" />
    
    <!-- Reconnection modal -->
    <div id="components-reconnect-modal" class="components-reconnect-dialog" role="dialog" aria-labelledby="reconnect-title" aria-describedby="reconnect-message">
        <div class="reconnect-content">
            <h5 id="reconnect-title">Connection Lost</h5>
            <p id="reconnect-message" class="reconnect-message">Attempting to reconnect...</p>
            <p class="reconnect-attempt">
                Attempt <span id="components-reconnect-current-attempt">0</span> / <span id="components-reconnect-max-retries">8</span>
            </p>
            <p class="reconnect-countdown">
                Next attempt in <span id="components-seconds-to-next-attempt">0</span>s
            </p>
            <button type="button" class="reconnect-retry-btn" id="reconnect-retry-btn" aria-label="Retry connection">
                Retry Now
            </button>
        </div>
    </div>

    <!-- Third-party scripts -->
    <script src="_content/MudBlazor/MudBlazor.min.js"></script>
    <script src="_content/Z.Blazor.Diagrams/script.min.js"></script>
    
    <!-- Blazor framework - autostart enabled, JS initializers handle configuration -->
    <script src="_framework/blazor.web.js"></script>
    
    <!-- Reconnection modal event handlers -->
    <script>
        (function() {
            'use strict';
            
            const SESSION_EXPIRED_RELOAD_DELAY_MS = 2000;
            
            const ReconnectState = Object.freeze({
                SHOW: 'show',
                HIDE: 'hide',
                RETRYING: 'retrying',
                FAILED: 'failed',
                REJECTED: 'rejected'
            });

            function initReconnectModal() {
                const modal = document.getElementById('components-reconnect-modal');
                const messageEl = document.getElementById('reconnect-message');
                const retryBtn = document.getElementById('reconnect-retry-btn');

                if (!modal || !messageEl || !retryBtn) {
                    return;
                }

                retryBtn.addEventListener('click', () => {
                    Blazor.reconnect();
                });

                modal.addEventListener('components-reconnect-state-changed', (event) => {
                    const { state } = event.detail;
                    const stateClasses = ['components-reconnect-show', 'components-reconnect-hide', 'components-reconnect-failed', 'components-reconnect-rejected'];
                    modal.classList.remove(...stateClasses);

                    switch (state) {
                        case ReconnectState.SHOW:
                            modal.classList.add('components-reconnect-show');
                            messageEl.textContent = 'Attempting to reconnect...';
                            retryBtn.hidden = true;
                            break;

                        case ReconnectState.HIDE:
                            modal.classList.add('components-reconnect-hide');
                            break;

                        case ReconnectState.RETRYING:
                            messageEl.textContent = 'Reconnecting...';
                            break;

                        case ReconnectState.FAILED:
                            modal.classList.add('components-reconnect-failed');
                            messageEl.textContent = 'Reconnection failed. Please try again.';
                            retryBtn.hidden = false;
                            break;

                        case ReconnectState.REJECTED:
                            modal.classList.add('components-reconnect-rejected');
                            messageEl.textContent = 'Session expired. Reloading page...';
                            retryBtn.hidden = true;
                            setTimeout(() => location.reload(), SESSION_EXPIRED_RELOAD_DELAY_MS);
                            break;
                    }
                });
            }

            // Initialize when DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initReconnectModal);
            } else {
                initReconnectModal();
            }
        })();
    </script>
</body>

</html>
