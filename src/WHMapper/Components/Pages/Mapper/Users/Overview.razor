@foreach(var account in Accounts)
{
    var badgeColor = account.Tracking ? Color.Success : Color.Error;
    var avatarStyle = account.IsPrimary 
        ? "border-color: white;border-width: 1px;border-style: solid;" 
        : (!account.HasMapAccess ? "opacity: 0.5;" : null);
    <MudTooltip Text="@(account.HasMapAccess ? null : "No access to primary account's maps")">
        <MudBadge Color="@badgeColor" Overlap="true" Bordered="true" Dot="true">
            <MudMenu ActivationEvent="@MouseEvent.RightClick">
                <ActivatorContent>
                    <MudAvatar Style="@avatarStyle">
                        <MudImage Src="@account.PortraitUrl"/>
                    </MudAvatar>
                </ActivatorContent>
                <ChildContent>
                    @if(account.IsPrimary)
                    {
                        <MudMenuItem Icon="@Icons.Material.Filled.Check" Disabled="true">Primary</MudMenuItem>
                    }
                    else
                    {
                        <MudMenuItem OnClick="@(() => SetPrimaryAccount(account.Id))">Set as Primary</MudMenuItem>
                    }
                    @if(account.Tracking)
                    {
                        <MudMenuItem Icon="@Icons.Material.Filled.GpsOff" OnClick="@(() => ToggleTracking(account.Id))">UnTrack</MudMenuItem>
                    }
                    else
                    {
                        <MudMenuItem Icon="@Icons.Material.Filled.GpsFixed" 
                                     OnClick="@(() => ToggleTracking(account.Id))" 
                                     Disabled="@(!account.HasMapAccess)">
                            @(account.HasMapAccess ? "Track" : "Track (No Access)")
                        </MudMenuItem>
                    }
                </ChildContent>
            </MudMenu>
        </MudBadge>
    </MudTooltip>
}
            

